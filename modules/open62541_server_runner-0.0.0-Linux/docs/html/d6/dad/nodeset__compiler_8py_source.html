<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project Template: nodeset_compiler.py Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../hs_layout.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project Template
   </div>
   <div id="projectbrief">Template project for your future repositories</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d6/dad/nodeset__compiler_8py_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">nodeset_compiler.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d6/dad/nodeset__compiler_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html">    1</a></span>&#160;<span class="comment">#!/usr/bin/env python</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"># This Source Code Form is subject to the terms of the Mozilla Public</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"># License, v. 2.0. If a copy of the MPL was not distributed with this</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"># file, You can obtain one at http://mozilla.org/MPL/2.0/.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">import</span> logging</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">import</span> argparse</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">from</span> datatypes <span class="keyword">import</span> NodeId</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">from</span> nodeset <span class="keyword">import</span> *</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a0895105982e493e986e8f3f3d20485b7">   30</a></span>&#160;parser = argparse.ArgumentParser(formatter_class=argparse.RawDescriptionHelpFormatter)</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;parser.add_argument(<span class="stringliteral">&#39;-e&#39;</span>, <span class="stringliteral">&#39;--existing&#39;</span>,</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a34777f6b92337fea3d8e22e754b627a3">   32</a></span>&#160;                    metavar=<span class="stringliteral">&quot;&lt;existingNodeSetXML&gt;&quot;</span>,</div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a7f14946ccabdbbf9ede2bee6e62571fb">   33</a></span>&#160;                    type=argparse.FileType(<span class="stringliteral">&#39;rb&#39;</span>),</div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a7bcfa5f54631b29e0b7ee4195b2ebb91">   34</a></span>&#160;                    dest=<span class="stringliteral">&quot;existing&quot;</span>,</div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#aa030863b8914350fe9b6f78d38849f94">   35</a></span>&#160;                    action=<span class="stringliteral">&#39;append&#39;</span>,</div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#af75ec0302a6571b1eb4f50fa7f0457ce">   36</a></span>&#160;                    default=[],</div><div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#ad7d9e29f00fa7df1c9b23b9c76ebe8e7">   37</a></span>&#160;                    help=<span class="stringliteral">&#39;NodeSet XML files with nodes that are already present on the server.&#39;</span>)</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;parser.add_argument(<span class="stringliteral">&#39;-x&#39;</span>, <span class="stringliteral">&#39;--xml&#39;</span>,</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                    metavar=<span class="stringliteral">&quot;&lt;nodeSetXML&gt;&quot;</span>,</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                    type=argparse.FileType(<span class="stringliteral">&#39;rb&#39;</span>),</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                    action=<span class="stringliteral">&#39;append&#39;</span>,</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                    dest=<span class="stringliteral">&quot;infiles&quot;</span>,</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                    default=[],</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                    help=<span class="stringliteral">&#39;NodeSet XML files with nodes that shall be generated.&#39;</span>)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;parser.add_argument(<span class="stringliteral">&#39;outputFile&#39;</span>,</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                    metavar=<span class="stringliteral">&#39;&lt;outputFile&gt;&#39;</span>,</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                    help=<span class="stringliteral">&#39;The path/basename for the &lt;output file&gt;.c and &lt;output file&gt;.h files to be generated. This will also be the function name used in the header and c-file.&#39;</span>)</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;parser.add_argument(<span class="stringliteral">&#39;--internal-headers&#39;</span>,</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                    action=<span class="stringliteral">&#39;store_true&#39;</span>,</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                    dest=<span class="stringliteral">&quot;internal_headers&quot;</span>,</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                    help=<span class="stringliteral">&#39;Include internal headers instead of amalgamated header&#39;</span>)</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;parser.add_argument(<span class="stringliteral">&#39;-b&#39;</span>, <span class="stringliteral">&#39;--blacklist&#39;</span>,</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                    metavar=<span class="stringliteral">&quot;&lt;blacklistFile&gt;&quot;</span>,</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                    type=argparse.FileType(<span class="stringliteral">&#39;r&#39;),</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="stringliteral">                    action=&#39;append&#39;</span>,</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                    dest=<span class="stringliteral">&quot;blacklistFiles&quot;</span>,</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                    default=[],</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                    help=<span class="stringliteral">&#39;Loads a list of NodeIDs stored in blacklistFile (one NodeID per line). Any of the nodeIds encountered in this file will be removed from the nodeset prior to compilation. Any references to these nodes will also be removed&#39;</span>)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;parser.add_argument(<span class="stringliteral">&#39;-i&#39;</span>, <span class="stringliteral">&#39;--ignore&#39;</span>,</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                    metavar=<span class="stringliteral">&quot;&lt;ignoreFile&gt;&quot;</span>,</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                    type=argparse.FileType(<span class="stringliteral">&#39;r&#39;),</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="stringliteral">                    action=&#39;append&#39;</span>,</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                    dest=<span class="stringliteral">&quot;ignoreFiles&quot;</span>,</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                    default=[],</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                    help=<span class="stringliteral">&#39;Loads a list of NodeIDs stored in ignoreFile (one NodeID per line). Any of the nodeIds encountered in this file will be kept in the nodestore but not printed in the generated code&#39;</span>)</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;parser.add_argument(<span class="stringliteral">&#39;-t&#39;</span>, <span class="stringliteral">&#39;--types-array&#39;</span>,</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                    metavar=<span class="stringliteral">&quot;&lt;typesArray&gt;&quot;</span>,</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                    action=<span class="stringliteral">&#39;append&#39;</span>,</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                    type=str,</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                    dest=<span class="stringliteral">&quot;typesArray&quot;</span>,</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                    default=[],</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                    help=<span class="stringliteral">&#39;Types array for the given namespace. Can be used mutliple times to define (in the same order as the .xml files, first for --existing, then --xml) the type arrays&#39;</span>)</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;parser.add_argument(<span class="stringliteral">&#39;-v&#39;</span>, <span class="stringliteral">&#39;--verbose&#39;</span>, action=<span class="stringliteral">&#39;count&#39;</span>,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                    default=1,</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                    help=<span class="stringliteral">&#39;Make the script more verbose. Can be applied up to 4 times&#39;</span>)</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;parser.add_argument(<span class="stringliteral">&#39;--backend&#39;</span>,</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                    default=<span class="stringliteral">&#39;open62541&#39;</span>,</div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a1d0e873bf85d94b037497b2fa450a637">   86</a></span>&#160;                    const=<span class="stringliteral">&#39;open62541&#39;</span>,</div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a7815a44fb5cdf45ea09d45528e04da14">   87</a></span>&#160;                    nargs=<span class="stringliteral">&#39;?&#39;</span>,</div><div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a47abd040f5159ab144466273e2670530">   88</a></span>&#160;                    choices=[<span class="stringliteral">&#39;open62541&#39;</span>, <span class="stringliteral">&#39;graphviz&#39;</span>],</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                    help=<span class="stringliteral">&#39;Backend for the output files (default: %(default)s)&#39;</span>)</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a50550aadc4e93278bf221fce97089c90">   91</a></span>&#160;args = parser.parse_args()</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"># Set up logging</span></div><div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#af6400db54144e3c972c3ceefc699380d">   94</a></span>&#160;logger = logging.getLogger(__name__)</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;logger.setLevel(logging.INFO)</div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a4035f552f80bd75b8c14fb6c541c2650">   96</a></span>&#160;verbosity = 0</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keywordflow">if</span> args.verbose:</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    verbosity = int(args.verbose)</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keywordflow">if</span> (verbosity == 1):</div><div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a6f18a9731cd7066dc8bc819320b04bc9">  100</a></span>&#160;    logging.basicConfig(level=logging.ERROR)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keywordflow">elif</span> (verbosity == 2):</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    logging.basicConfig(level=logging.WARNING)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keywordflow">elif</span> (verbosity == 3):</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    logging.basicConfig(level=logging.INFO)</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keywordflow">elif</span> (verbosity &gt;= 4):</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    logging.basicConfig(level=logging.DEBUG)</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keywordflow">else</span>:</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    logging.basicConfig(level=logging.CRITICAL)</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"># Create a new nodeset. The nodeset name is not significant.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"># Parse the XML files</span></div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a32ab629fed09cd141b51ebe04a0751ff">  112</a></span>&#160;ns = <a class="code" href="../../d5/dda/classnodeset__compiler_1_1nodeset_1_1NodeSet.html">NodeSet</a>()</div><div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a15cffc69946bbd2ab149ee71daaf8f78">  113</a></span>&#160;nsCount = 0</div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#ac07a8dfd381c78560298e0d6c5edeba0">  114</a></span>&#160;loadedFiles = list()</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#ab23a468ddf52d83f91616a232e2eb1ca">  117</a></span>&#160;<span class="keyword">def </span><a class="code" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#ab23a468ddf52d83f91616a232e2eb1ca">getTypesArray</a>(nsIdx):</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> nsIdx &lt; len(args.typesArray):</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">return</span> args.typesArray[nsIdx]</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;UA_TYPES&quot;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="keywordflow">for</span> xmlfile <span class="keywordflow">in</span> args.existing:</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> xmlfile.name <span class="keywordflow">in</span> loadedFiles:</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        logger.info(<span class="stringliteral">&quot;Skipping Nodeset since it is already loaded: {} &quot;</span>.format(xmlfile.name))</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">continue</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    loadedFiles.append(xmlfile.name)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    logger.info(<span class="stringliteral">&quot;Preprocessing (existing) &quot;</span> + str(xmlfile.name))</div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a3369147af8fb1ca189b90ba0b3c15a0c">  129</a></span>&#160;    ns.addNodeSet(xmlfile, <span class="keyword">True</span>, typesArray=<a class="code" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#ab23a468ddf52d83f91616a232e2eb1ca">getTypesArray</a>(nsCount))</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    nsCount +=1</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keywordflow">for</span> xmlfile <span class="keywordflow">in</span> args.infiles:</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">if</span> xmlfile.name <span class="keywordflow">in</span> loadedFiles:</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        logger.info(<span class="stringliteral">&quot;Skipping Nodeset since it is already loaded: {} &quot;</span>.format(xmlfile.name))</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">continue</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    loadedFiles.append(xmlfile.name)</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    logger.info(<span class="stringliteral">&quot;Preprocessing &quot;</span> + str(xmlfile.name))</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    ns.addNodeSet(xmlfile, typesArray=<a class="code" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#ab23a468ddf52d83f91616a232e2eb1ca">getTypesArray</a>(nsCount))</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    nsCount +=1</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"># # We need to notify the open62541 server of the namespaces used to be able to use i.e. ns=3</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"># namespaceArrayNames = preProc.getUsedNamespaceArrayNames()</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"># for key in namespaceArrayNames:</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">#   ns.addNamespace(key, namespaceArrayNames[key])</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"># Remove blacklisted nodes from the nodeset</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment"># Doing this now ensures that unlinkable pointers will be cleanly removed</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"># during sanitation.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="keywordflow">for</span> blacklist <span class="keywordflow">in</span> args.blacklistFiles:</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">for</span> line <span class="keywordflow">in</span> blacklist.readlines():</div><div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a0226330e2753077a4edb9d3284787495">  150</a></span>&#160;        line = line.replace(<span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#af5ac68d85a367c4df9a152e37a829f39">  151</a></span>&#160;        id = line.replace(<span class="stringliteral">&quot;\n&quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">if</span> ns.getNodeByIDString(id) <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            logger.info(<span class="stringliteral">&quot;Can&#39;t blacklist node, namespace does currently not contain a node with id &quot;</span> + str(id))</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            ns.removeNodeById(line)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    blacklist.close()</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"># Set the nodes from the ignore list to hidden. This removes them from dependency calculation</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment"># and from printing their generated code.</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment"># These nodes should be already pre-created on the server to avoid any errors during</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"># creation.</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keywordflow">for</span> ignoreFile <span class="keywordflow">in</span> args.ignoreFiles:</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">for</span> line <span class="keywordflow">in</span> ignoreFile.readlines():</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        line = line.replace(<span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        id = line.replace(<span class="stringliteral">&quot;\n&quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        ns.hide_node(<a class="code" href="../../d8/d5f/classnodeset__compiler_1_1datatypes_1_1NodeId.html">NodeId</a>(id))</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="comment">#if not ns.hide_node(NodeId(id)):</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">#    logger.info(&quot;Can&#39;t ignore node, namespace does currently not contain a node with id &quot; + str(id))</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    ignoreFile.close()</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"># Remove nodes that are not printable or contain parsing errors, such as</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment"># unresolvable or no references or invalid NodeIDs</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;ns.sanitize()</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment"># Parse Datatypes in order to find out what the XML keyed values actually</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment"># represent.</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment"># Ex. &lt;rpm&gt;123&lt;/rpm&gt; is not encodable</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">#     only after parsing the datatypes, it is known that</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">#     rpm is encoded as a double</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;ns.buildEncodingRules()</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment"># Allocate/Parse the data values. In order to do this, we must have run</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment"># buidEncodingRules.</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;ns.allocateVariables()</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;ns.addInverseReferences()</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;ns.setNodeParent()</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;logger.info(<span class="stringliteral">&quot;Generating Code for Backend: {}&quot;</span>.format(args.backend))</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="keywordflow">if</span> args.backend == <span class="stringliteral">&quot;open62541&quot;</span>:</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment"># Create the C code with the open62541 backend of the compiler</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keyword">from</span> backend_open62541 <span class="keyword">import</span> generateOpen62541Code</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <a class="code" href="../../d0/d37/namespacenodeset__compiler_1_1backend__open62541.html#af06887eb003f60b4f7f98e89753469e6">generateOpen62541Code</a>(ns, args.outputFile, args.internal_headers, args.typesArray)</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keywordflow">elif</span> args.backend == <span class="stringliteral">&quot;graphviz&quot;</span>:</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keyword">from</span> backend_graphviz <span class="keyword">import</span> generateGraphvizCode</div><div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#a7d6964e20a0f9d4db90b2adf433bafeb">  199</a></span>&#160;    <a class="code" href="../../d5/d4a/namespacenodeset__compiler_1_1backend__graphviz.html#ab448a9c248add224e9f0a052f92be2bb">generateGraphvizCode</a>(ns, filename=args.outputFile)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keywordflow">else</span>:</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    logger.error(<span class="stringliteral">&quot;Unsupported backend: {}&quot;</span>.format(args.backend))</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    exit(1)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;logger.info(<span class="stringliteral">&quot;NodeSet generation code successfully printed&quot;</span>)</div><div class="ttc" id="namespacenodeset__compiler_1_1backend__graphviz_html_ab448a9c248add224e9f0a052f92be2bb"><div class="ttname"><a href="../../d5/d4a/namespacenodeset__compiler_1_1backend__graphviz.html#ab448a9c248add224e9f0a052f92be2bb">nodeset_compiler.backend_graphviz.generateGraphvizCode</a></div><div class="ttdeci">def generateGraphvizCode(nodeset, filename=&quot;dependencies&quot;, rootNode=None, excludeNodeIds=[])</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d89/backend__graphviz_8py_source.html#l00139">backend_graphviz.py:139</a></div></div>
<div class="ttc" id="classnodeset__compiler_1_1nodeset_1_1NodeSet_html"><div class="ttname"><a href="../../d5/dda/classnodeset__compiler_1_1nodeset_1_1NodeSet.html">nodeset_compiler.nodeset.NodeSet</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d51/nodeset_8py_source.html#l00108">nodeset.py:108</a></div></div>
<div class="ttc" id="classnodeset__compiler_1_1datatypes_1_1NodeId_html"><div class="ttname"><a href="../../d8/d5f/classnodeset__compiler_1_1datatypes_1_1NodeId.html">nodeset_compiler.datatypes.NodeId</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd1/datatypes_8py_source.html#l00522">datatypes.py:522</a></div></div>
<div class="ttc" id="namespacenodeset__compiler_1_1backend__open62541_html_af06887eb003f60b4f7f98e89753469e6"><div class="ttname"><a href="../../d0/d37/namespacenodeset__compiler_1_1backend__open62541.html#af06887eb003f60b4f7f98e89753469e6">nodeset_compiler.backend_open62541.generateOpen62541Code</a></div><div class="ttdeci">def generateOpen62541Code(nodeset, outfilename, internal_headers=False, typesArray=[])</div><div class="ttdoc">Generate C Code #. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/da2/backend__open62541_8py_source.html#l00133">backend_open62541.py:133</a></div></div>
<div class="ttc" id="namespacenodeset__compiler_1_1nodeset__compiler_html_ab23a468ddf52d83f91616a232e2eb1ca"><div class="ttname"><a href="../../d1/d89/namespacenodeset__compiler_1_1nodeset__compiler.html#ab23a468ddf52d83f91616a232e2eb1ca">nodeset_compiler.nodeset_compiler.getTypesArray</a></div><div class="ttdeci">def getTypesArray(nsIdx)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dad/nodeset__compiler_8py_source.html#l00117">nodeset_compiler.py:117</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_4fef79e7177ba769987a8da36c892c5f.html">build</a></li><li class="navelem"><a class="el" href="../../dir_bfec047177fd926ba88764c7f25fa1bf.html">libs</a></li><li class="navelem"><a class="el" href="../../dir_6a6267cc43a81173d5b57ea3feb188cc.html">share</a></li><li class="navelem"><a class="el" href="../../dir_ab00597d9c80f147087f8c5b4edb9a6e.html">open62541</a></li><li class="navelem"><a class="el" href="../../dir_0b34865675a438c3ae932c9fb348c2b8.html">tools</a></li><li class="navelem"><a class="el" href="../../dir_6a09f9898adda22c43562e41e879dc92.html">nodeset_compiler</a></li><li class="navelem"><a class="el" href="../../d6/dad/nodeset__compiler_8py.html">nodeset_compiler.py</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
